<section data-ng-controller="DrivesController" data-ng-init="findOne()">

  <div class="row">
    <div class="col-md-6">
      <h2>Drive {{drive.name}}</h2>
      <span>{{drive.created | date:'medium'}}</span> /
      <span data-ng-if="hasAuthorization(drive)">
        <a class="btn" href="/#!/drives/{{drive._id}}/edit">
          <i class="glyphicon glyphicon-edit"></i>
        </a>
        <a class="btn" data-ng-click="remove(drive);">
          <i class="glyphicon glyphicon-trash"></i>
        </a>
      </span>

      <ul class="files unstyled">
        <li data-ng-repeat="file in drive.files">
          <span>{{file.created | date:'medium'}}</span> /
          <span>{{file.user.name}}</span>
          <h3>
            <a data-ng-href="#!/files/{{file._id}}">{{file.name}}</a>
          </h3>
        </li>
      </ul>
    </div>

    <!-- Right panel -->
    <div class="col-md-6" style="margin-bottom: 40px;">
  
      <h3>Share with</h3>

      <form name="shareDriveForm" class="col-md-12" role="form" data-ng-submit="update(shareDriveForm.$valid)" novalidate>
        <!-- Public/Private -->
        <div class="form-group">
          <label for="public" class="col-md-3 control-label">Everyone (public)</label>
          <div class="col-md-9">
            <div class="onoffswitch">
              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox form-control" ng-model="drive.public" id="public" ng-click="update(shareDriveForm.$valid)" checked>
              <label class="onoffswitch-label" for="public">
                <span class="onoffswitch-inner">
                  <span class="onoffswitch-active"><span class="onoffswitch-switch">ON</span></span>
                  <span class="onoffswitch-inactive"><span class="onoffswitch-switch">OFF</span></span>
                </span>
              </label>
            </div>
          </div>
        </div>

        <!-- Users -->
        <div ng-show="!drive.public">
          <div class="col-md-11">
            <div class="form-group form-horizontal" ng-class="{ 'has-error' : submitted && shareDriveForm.users.$invalid }">
              <label for="users" class="col-md-2 control-label">Users</label>
              <div class="col-md-10">
                <tags-input name="users" id="users" ng-model="drive.users" key-property="_id" display-property="username" add-from-autocomplete-only="true" placeholder="Martin, John, ...">
                  <auto-complete source="autocompleteUser($query)"></auto-complete>
                </tags-input>
                <div ng-show="submitted && shareDriveForm.users.$invalid" class="help-block">
                  <p ng-repeat="error in shareDriveForm.errors">error: {{ error }}</p>
                  <!--<p ng-show="shareDriveForm.users.$error.invalid">Username is invalid</p>-->
                </div>
              </div>
            </div>
          </div>
          
          <!-- Add button -->
          <div class="form-group">
            <div class="col-md-1">
              <button type="submit" class="btn btn-primary">
                <span class="glyphicon glyphicon-plus"></span>
              </button>
            </div>
          </div>
        </div>
      </form>

      <!-- Upload files -->
      <h3>Upload more</h3>

      <div class="fileUpload btn btn-primary">
          <span>Upload files</span>
          <input type="file" class="upload" nv-file-select="" uploader="uploader" multiple/><br/>
      </div>
      <div class="upload" ng-show="uploader.isHTML5">
        <div class="well" nv-file-over over-class="file-drop-over" nv-file-drop uploader="uploader">
          Drop files here
        </div>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th width="50%">Name</th>
            <th ng-show="uploader.isHTML5">Size</th>
            <th ng-show="uploader.isHTML5">Progress</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="item in uploader.queue">
            <td><strong>{{ item.file.name }}</strong></td>
            <td ng-show="uploader.isHTML5" nowrap>{{ item.file.size/1024/1024|number:2 }} MB</td>
            <td class="text-center">
              <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span>
              <span ng-show="item.isCancel"><i class="glyphicon glyphicon-ban-circle"></i></span>
              <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span>
            </td>
            <td nowrap>
              <button type="button" class="btn btn-success btn-xs" ng-click="item.upload()" ng-disabled="item.isReady || item.isUploading || item.isSuccess">
                <span class="glyphicon glyphicon-upload"></span>
              </button>
              <button type="button" class="btn btn-warning btn-xs" ng-click="item.cancel()" ng-disabled="!item.isUploading">
                <span class="glyphicon glyphicon-ban-circle"></span>
              </button>
              <button type="button" class="btn btn-danger btn-xs" ng-click="item.remove()">
                <span class="glyphicon glyphicon-trash"></span>
              </button>
            </td>

            
            <td ng-show="uploader.isHTML5">
              <div class="progress" style="margin-bottom: 0;">
                <div class="progress-bar" role="progressbar" ng-style="{ 'width': item.progress + '%' }"></div>
              </div>
            </td>

          </tr>
        </tbody>
      </table>
      
      <p>Queue length: {{ uploader.queue.length }} / {{ uploader.queue.limit }}</p>

      <div>
        <div>
          Queue progress:
          <div class="progress" style="">
            <div class="progress-bar" role="progressbar" ng-style="{ 'width': uploader.progress + '%' }"></div>
          </div>
        </div>
        <button type="button" class="btn btn-success btn-s" ng-click="uploader.uploadAll()" ng-disabled="!uploader.getNotUploadedItems().length">
          <span class="glyphicon glyphicon-upload"></span> Upload all
        </button>
        <button type="button" class="btn btn-warning btn-s" ng-click="uploader.cancelAll()" ng-disabled="!uploader.isUploading">
          <span class="glyphicon glyphicon-ban-circle"></span> Cancel all
        </button>
        <button type="button" class="btn btn-danger btn-s" ng-click="uploader.clearQueue()" ng-disabled="!uploader.queue.length">
          <span class="glyphicon glyphicon-trash"></span> Remove all
        </button>
      </div>
    </div>
  </div>
</section>

